var deps=deps||{};deps.socket=io();var socket=socket||{},io=deps.socket;socket.init=function(){if(Modernizr.localstorage){var a=localStorage.getItem("mdw");a||(a=JSON.stringify({}));a=$.parseJSON(a);io.emit("registerSocket",a.user)}};socket.init();io.on("responseRegister",function(a){alert(a.message);a.status&&(user.cleanUserForm(),window.location="/login")});
io.on("responseLogin",function(a){a.status?(user.cleanLoginForm(),user.user=a.data[0],delete user.user.password,cookie.set("mdw-user",JSON.stringify(user.user)),Modernizr.localstorage&&((a=localStorage.getItem("mdw"))||(a={}),a.user=user.user,localStorage.setItem("mdw",JSON.stringify(a))),io.emit("registerSocket",user.user)):alert(a.message)});var user=user||{};user.init=function(){user.bindingRegister();user.bindingLogin()};user.bindingRegister=function(){$(document).on("submit","#register-form",function(a){a.preventDefault();a=$(this).find("#username").val();var b=$(this).find("#email").val(),c=$(this).find("#password").val();user.register({username:a,email:b,password:c})})};user.register=function(a){deps.socket.emit("registerUser",a)};user.cleanUserForm=function(){$(document).find("#register-form").find("input").each(function(a,b){$(this).val("")})};
user.bindingLogin=function(){$(document).on("submit","#login-form",function(a){a.preventDefault();a=$(this).find("#username").val();var b=$(this).find("#password").val();user.login({username:a,password:b})})};user.login=function(a){deps.socket.emit("login",a)};user.cleanLoginForm=function(){$(document).find("#login-form").find("input").each(function(a,b){$(this).val("")})};user.init();
